<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.139.4">
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>NVIDIA Quantum Secure Gateway :: Qrypt</title>

    
    <link href="../../css/nucleus.css?1734382870" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1734382870" rel="stylesheet">
    <link href="../../css/hybrid.css?1734382870" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1734382870" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1734382870" rel="stylesheet">
    <link href="../../css/auto-complete.css?1734382870" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1734382870" rel="stylesheet">
    <link href="../../css/theme.css?1734382870" rel="stylesheet">
    <link href="../../css/tabs.css?1734382870" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1734382870" rel="stylesheet">
    
    <link href="../../css/theme-mine.css?1734382870" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1734382870"></script>

    
  </head>
  
  <body class="" data-url="../../sdk/nvidia/">
    <nav
  id="sidebar"
  class=""
>
   
  <div id="header-wrapper">
    <div id="header">
      <a href="../../"> <svg width="70%" height="70%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1466.34 440.83"><g fill="#171629"><path d="m731.72 325v33.11h-26.49q-16.14 0-26.07-4.56t-17.8-15.31l-2.9-4.14q-34.76 26.49-82.77 26.49-40.14 0-71.6-19t-49-52.56q-17.6-33.53-17.59-75.73t17.59-75.74q17.59-33.52 49-52.56t71.6-19q40.14 0 71.6 19t49 52.56q17.59 33.53 17.59 75.74a167.71 167.71 0 0 1 -8.28 53.38 145.11 145.11 0 0 1 -23.59 44.29q5.79 7.86 12 11t15.36 3.03zm-94-19-7.86-10.76q-5.8-7.86-11.59-11.17a27.07 27.07 0 0 0 -13.66-3.31h-24.37v-33.2h30.22q14.06 0 23.17 4.76t17 15.52l9.11 12.41q17.37-28.14 17.38-67 0-33.11-12.83-59t-35.8-40.56q-23-14.69-52.8-14.69t-52.77 14.69q-23 14.7-35.79 40.56t-12.83 59q0 33.1 12.83 59t35.79 40.56q23 14.7 52.77 14.69 36.02-.07 62.08-21.59z" style="fill: #000000;"/><path d="m870.17 147v33.1h-17q-30.17 0-43.17 20.28t-13 50.07v107.61h-34v-211.06h29.38l4.56 31.87a69.91 69.91 0 0 1 23.59-23.18q14.47-8.69 40.12-8.69z" style="fill: #000000;"/><path d="m925 147 65 172.16 62.9-172.16h36l-97.25 246.65q-7.46 19-13.24 28.56a37.35 37.35 0 0 1 -14.49 14.07q-8.68 4.55-23.18 4.55h-40.55v-31h30.21q9.93 0 14.9-2.07a17.59 17.59 0 0 0 8.07-6.83q3.11-4.75 7.65-15.93l10.76-25.25-82.78-212.75z" style="fill: #000000;"/><path d="m1272.86 157.34q23 12.82 36 37.24t13 57.94q0 31.87-13 56.29a95.29 95.29 0 0 1 -36.21 38.07q-23.19 13.67-52.15 13.66-25.66 0-43.87-9.31a72 72 0 0 1 -28.55-25.45v115.05h-33.94v-293.83h29.38l4.56 33.94q26.48-36.42 72.42-36.42 29.4-.01 52.36 12.82zm-5 151.26q19.24-21.72 19.24-56.08t-19.24-56.07q-19.25-21.73-50.7-21.73-20.28 0-36.21 9.72a64.88 64.88 0 0 0 -24.63 27.32q-8.68 17.6-8.69 39.94 0 22.76 8.69 40.76a65.78 65.78 0 0 0 24.68 27.94q15.93 9.93 36.21 9.93 31.43 0 50.69-21.73z" style="fill: #000000;"/><path d="m1372.4 178h-38.08v-31h38.08v-59.19h33.93v59.19h53.39v31h-53.39v124.6q0 13.25 5.18 18.83t18 5.59h36.83v31h-38.9q-29.81 0-42.42-13.25t-12.62-41.77z" style="fill: #000000;"/><path d="m257.37 241.66 122.43 122.43-23.22 23.26-125.39-125.44 18.59 71.67-31.82 8.25-16.67-64.16-29.63 110.73-31.73-8.51 30.77-114.96-111.04 111.03-23.26-23.22 109.59-109.59-97.06 24.96-8.16-31.86 100.16-25.75-140.93-37.75 8.51-31.73 139.01 37.23-45.96-45.96 23.22-23.22 44.26 44.25-37.67-145.07 31.82-8.25 38.62 148.74 25.1-93.79 31.77 8.51-24.52 91.52 111.59-111.6 23.23 23.27-114.7 114.69 127.53-32.77 8.2 31.81-119.63 30.77 85.76 22.96-8.51 31.73z" style="fill: #000000;"/></g></svg> <span>Documentation</span></a>
    </div>
    
  </div>
  

  <div class="highlightable">
    <ul class="topics">
               
<li
  data-nav-id="/getting_started/"
  title="Getting Started"
  class="dd-item
        
        
        
        "
>
  <a href="../../getting_started/">
    Getting Started 
  </a>
   
</li>
           
<li
  data-nav-id="/eaas/"
  title="Quantum Entropy"
  class="dd-item
        
        
        
        "
>
  <a href="../../eaas/">
    Quantum Entropy 
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/eaas/appliance/"
  title=""
  class="dd-item
        
        
        
        "
>
  <a href="../../eaas/appliance/">
    On-Prem Appliance 
  </a>
   
</li>
    
            
<li
  data-nav-id="/eaas/rngd/"
  title="RNG Tools"
  class="dd-item
        
        
        
        "
>
  <a href="../../eaas/rngd/">
    RNG Tools 
  </a>
   
</li>
    
            
<li
  data-nav-id="/eaas/nist/"
  title="NIST Entropy Quality Tests"
  class="dd-item
        
        
        
        "
>
  <a href="../../eaas/nist/">
    NIST Entropy Quality Tests 
  </a>
   
</li>
    
            
<li
  data-nav-id="/eaas/pkcs11/"
  title="Qseed"
  class="dd-item
        
        
        
        "
>
  <a href="../../eaas/pkcs11/">
    Qseed 
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/dqkd/"
  title="Digital Quantum Key Distribution (DQKD)  "
  class="dd-item
        
        
        
        "
>
  <a href="../../dqkd/">
    DQKD 
  </a>
   
</li>
           
<li
  data-nav-id="/sdk/"
  title="Key Generation"
  class="dd-item
        parent
        
        
        "
>
  <a href="../../sdk/">
    Key Generation 
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/sdk/overview/"
  title="Overview"
  class="dd-item
        
        
        
        "
>
  <a href="../../sdk/overview/">
    Overview 
  </a>
   
</li>
    
            
<li
  data-nav-id="/sdk/quickstarts/"
  title="Quickstarts"
  class="dd-item
        
        
        
        "
>
  <a href="../../sdk/quickstarts/">
    Quickstarts 
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/sdk/quickstarts/cpp/"
  title="Qrypt SDK Quickstarts"
  class="dd-item
        
        
        
        "
>
  <a href="../../sdk/quickstarts/cpp/">
    Qrypt SDK Quickstarts 
  </a>
   
</li>
     
  </ul>
  
</li>
    
            
<li
  data-nav-id="/sdk/nvidia/"
  title="NVIDIA Quantum Secure Gateway"
  class="dd-item
        
        active
        
        "
>
  <a href="../../sdk/nvidia/">
    NVIDIA Quantum Secure Gateway 
  </a>
   
</li>
    
            
<li
  data-nav-id="/sdk/api/"
  title="API Reference"
  class="dd-item
        
        
        
        "
>
  <a href="../../sdk/api/">
    API Reference 
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/sdk/api/cpp/"
  title="Qrypt SDK"
  class="dd-item
        
        
        
        "
>
  <a href="../../sdk/api/cpp/">
    Qrypt SDK 
  </a>
   
</li>
     
  </ul>
  
</li>
    
            
<li
  data-nav-id="/sdk/changelogs/"
  title="Changelogs"
  class="dd-item
        
        
        
        "
>
  <a href="../../sdk/changelogs/">
    Changelogs 
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/quantumreadiness/"
  title="Quantum Readiness with Qrypt"
  class="dd-item
        
        
        
        "
>
  <a href="../../quantumreadiness/">
    Quantum Readiness 
  </a>
   
</li>
           
<li
  data-nav-id="/postquantumproxy/"
  title="Post quantum TLS proxy"
  class="dd-item
        
        
        
        "
>
  <a href="../../postquantumproxy/">
    Post quantum TLS proxy 
  </a>
   
</li>
           
<li
  data-nav-id="/openssh/"
  title="Portable OpenSSH with Qrypt"
  class="dd-item
        
        
        
        "
>
  <a href="../../openssh/">
    Qrypt OpenSSH 
  </a>
   
</li>
           
<li
  data-nav-id="/concepts/"
  title="Concepts"
  class="dd-item
        
        
        
        "
>
  <a href="../../concepts/">
    Concepts 
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/concepts/key-generation-architecture/"
  title="Key Generation Architecture"
  class="dd-item
        
        
        
        "
>
  <a href="../../concepts/key-generation-architecture/">
    Key Generation Architecture 
  </a>
   
</li>
    
            
<li
  data-nav-id="/concepts/entropy-projection/"
  title="Key Entropy Size"
  class="dd-item
        
        
        
        "
>
  <a href="../../concepts/entropy-projection/">
    Key Entropy Size 
  </a>
   
</li>
    
            
<li
  data-nav-id="/concepts/otp/"
  title="One-Time Pad (OTP)"
  class="dd-item
        
        
        
        "
>
  <a href="../../concepts/otp/">
    One-Time Pad (OTP) 
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/faqs/"
  title="Frequently Asked Questions"
  class="dd-item
        
        
        
        "
>
  <a href="../../faqs/">
    FAQs 
  </a>
   
</li>
    
    </ul>

        
    <section id="footer"><section id="shortcuts">
  <h3></h3>
  <ul>
    <li>
      <a class="padding" href="https://www.qrypt.com/" target="_blank"
        ><div class="link-container">
          <svg
            height="16px"
            width="16px"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 390.01 388.4"
          >
            <path
              d="m257.37 241.66 122.43 122.43-23.22 23.26-125.39-125.44 18.59 71.67-31.82 8.25-16.67-64.16-29.63 110.73-31.73-8.51 30.77-114.96-111.04 111.03-23.26-23.22 109.59-109.59-97.06 24.96-8.16-31.86 100.16-25.75-140.93-37.75 8.51-31.73 139.01 37.23-45.96-45.96 23.22-23.22 44.26 44.25-37.67-145.07 31.82-8.25 38.62 148.74 25.1-93.79 31.77 8.51-24.52 91.52 111.59-111.6 23.23 23.27-114.7 114.69 127.53-32.77 8.2 31.81-119.63 30.77 85.76 22.96-8.51 31.73z"
              fill="currentColor"
              style="fill: currentColor"
            /></svg
          >&nbspQrypt Website
        </div></a
      >
    </li>

    <li>
      <a class="padding" href="https://portal.qrypt.com/" target="_blank"
        ><div class="link-container">
          <svg
            height="16px"
            width="16px"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 390.01 388.4"
          >
            <path
              d="m257.37 241.66 122.43 122.43-23.22 23.26-125.39-125.44 18.59 71.67-31.82 8.25-16.67-64.16-29.63 110.73-31.73-8.51 30.77-114.96-111.04 111.03-23.26-23.22 109.59-109.59-97.06 24.96-8.16-31.86 100.16-25.75-140.93-37.75 8.51-31.73 139.01 37.23-45.96-45.96 23.22-23.22 44.26 44.25-37.67-145.07 31.82-8.25 38.62 148.74 25.1-93.79 31.77 8.51-24.52 91.52 111.59-111.6 23.23 23.27-114.7 114.69 127.53-32.77 8.2 31.81-119.63 30.77 85.76 22.96-8.51 31.73z"
              fill="currentColor"
              style="fill: currentColor"
            /></svg
          >&nbspQrypt Portal
        </div></a
      >
    </li>

    <li>
      <a
        class="padding"
        href="https://github.com/QryptInc/QryptInc.github.io"
        target="_blank"
        ><i class="fab fa-github"></i> Github Repo</a
      >
    </li>

    <li>
      <a href="https://www.qrypt.com/contact/" target="_blank"
        >Help & Support</a
      >
    </li>
  </ul>
</section>
</section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">


        <div id="head-tags">
        
        </div>

        <span id="sidebar-toggle-span" class="custom-sidebar-toggle">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fas fa-bars"></i>
          </a>
        </span>

        <div id="body-inner">          
          
            <h1>
              
              NVIDIA Quantum Secure Gateway
            </h1>
          

        



	<p>As the quantum era approaches, the need for cryptographic systems that can withstand the power of quantum computing becomes increasingly urgent. Current key exchange mechanisms like Elliptic Curve Diffie-Hellman (ECDH) are vulnerable to attacks from quantum computers, which can easily break these algorithms. To address this looming threat, it is critical to incorporate post-quantum key exchanges alongside traditional methods like (EC)DH to ensure that the resulting shared keys are secure against quantum-based attacks. RFC 9370 provides a framework for enhancing the Internet Key Exchange (IKEv2) protocol by enabling multiple successive key exchanges, including Post-Quantum Cryptography (PQC) techniques. This allows for the seamless integration of quantum-resistant algorithms with existing cryptographic protocols, ensuring compatibility while significantly strengthening security. The derived IKEv2 keys, fortified with these advanced techniques, are thus designed to be robust against the unprecedented capabilities of quantum computers.</p>
<p>Qrypt integrated the BLAST protocol and post-quantum algorithms in IKEv2 as additional key exchange methods, providing security against Harvest Now Decrypt Later (HNDL) attacks and future quantum attacks. This solution, is built as an IPsec plug-in that seamlessly combines existing classical and quantum-secure key exchanges with Qrypt’s BLAST protocol. The solution leverages the <a href="https://www.nvidia.com/content/dam/en-zz/Solutions/Data-Center/documents/datasheet-nvidia-bluefield-3-dpu.pdf">NVIDIA Bluefield-3 DPU’s</a> hardware capability for secure network communication and optimized performance. Support for the Qrypt plug-in can be easily enabled by configuring the StrongSwan service running on the DPUs.</p>
<hr>
<h1 id="quick-recap-of-ikev2">Quick Recap of IKEv2</h1>
<ul>
<li><strong>IKE_SA_INIT:</strong> Communication using IKE always begins with <strong>IKE_SA_INIT</strong> and <strong>IKE_AUTH</strong> exchanges. The first pair of messages (<strong>IKE_SA_INIT</strong>) negotiate cryptographic algorithms, exchange nonces, and do a Diffie-Hellman exchange.</li>
<li><strong>IKE_AUTH:</strong> The second pair of messages (<strong>IKE_AUTH</strong>) authenticate the previous messages, exchange identities and certificates, and establish the first Child SA. Parts of these messages are encrypted and integrity protected with keys established through the <strong>IKE_SA_INIT</strong> exchange, so the identities are hidden from eavesdroppers and all fields in all the messages are authenticated.</li>
<li><strong>CREATE_CHILD_SA:</strong> All messages following the initial exchange are cryptographically protected using the cryptographic algorithms and keys negotiated in the <strong>IKE_SA_INIT</strong> exchange. At this point in the negotiation, each party can generate a quantity called <strong>SKEYSEED</strong>, from which all keys are derived for the IKE SA. The messages that follow are encrypted and integrity protected in their entirety, with the exception of the message headers.</li>
</ul>
<figure><img src="../../sdk/nvidia/images/Diagram_3.png">
</figure>

<hr>
<h1 id="rfc-9370-summary-multiple-key-exchanges-in-ikev2">RFC 9370 Summary: Multiple Key Exchanges in IKEv2</h1>
<h2 id="overview">Overview</h2>
<p><a href="https://datatracker.ietf.org/doc/rfc9370/">RFC 9370</a> extends the Internet Key Exchange Version 2 (IKEv2) protocol to facilitate multiple key exchanges during the establishment of a Security Association (SA). This enhancement allows the computation of a final shared secret derived from multiple component key exchange secrets. Key points include:</p>
<ul>
<li><strong>Final Shared Secret</strong>: The shared secret is computed from all component key exchange secrets.</li>
<li><strong>Compatibility</strong>: If both peers do not support the new exchanges, the final shared secret will match the one specified in <a href="https://datatracker.ietf.org/doc/html/rfc7296">RFC 7296</a>.</li>
<li><strong>Post-Quantum Security</strong>: If any component utilizes a quantum-safe algorithm, the resulting shared secret is also post-quantum secure.</li>
</ul>
<h2 id="negotiation-methods">Negotiation Methods</h2>
<p>There are two primary methods to negotiate additional key exchange algorithms and establish quantum-secure IKE SAs: utilizing <strong>IKE_INTERMEDIATE</strong> exchanges during the initial Security Association (SA) setup or employing the <strong>IKE_FOLLOWUP_KE</strong> exchange for subsequent key exchanges. Below is a step-by-step breakdown of each method:</p>
<h3 id="option-1-using-ike_intermediate-exchanges">Option 1: Using IKE_INTERMEDIATE Exchanges</h3>
<ol>
<li><strong>IKE_SA_INIT Negotiation</strong>:
<ul>
<li>The key exchange method negotiated via Transform Type 4 (ECDH) takes place.</li>
<li>The initiator includes up to seven newly defined transforms, that represent the extra key exchanges, in the SA payload within the <strong>IKE_SA_INIT</strong> message.</li>
<li>The responder selects key exchange methods and returns their IDs in the <strong>IKE_SA_INIT</strong> response.</li>
<li>Additional key exchanges are negotiated, leading to one or more <strong>IKE_INTERMEDIATE</strong> exchanges.</li>
</ul>
</li>
<li><strong>IKE_INTERMEDIATE Exchanges</strong>:
<ul>
<li>For each additional key exchange agreed upon, an <strong>IKE_INTERMEDIATE</strong> exchange is performed.</li>
<li>The initiator sends key exchange data using the <strong>KEi(n)</strong> payload, protected with current keys <strong>SK_ei/SK_ai</strong>.</li>
<li>The responder responds with the <strong>KEr(n)</strong> payload, also protected with <strong>SK_er/SK_ar</strong>.</li>
<li>Both sides compute updated keying materials from the shared secrets generated during these exchanges.</li>
</ul>
</li>
<li><strong>IKE_AUTH Exchange</strong>:
<ul>
<li>After completing <strong>IKE_INTERMEDIATE</strong> exchanges, the initiator and responder perform the <strong>IKE_AUTH</strong> exchange, as per the IKEv2 specification.</li>
</ul>
</li>
</ol>
<p>The shared keying material is completed as follows:</p>
<pre tabindex="0"><code>SKEYSEED(n) = prf(SK_d(n-1), SK(n) | Ni | Nr)
</code></pre><p>Where:</p>
<ul>
<li><strong>SK(n)</strong> is the shared secret from the current exchange.</li>
<li><strong>Ni</strong> and <strong>Nr</strong> are nonces from the <strong>IKE_SA_INIT</strong> exchange.</li>
<li><strong>SK_d(n-1)</strong> is the previously generated SK_d (from <strong>IKE_SA_INIT</strong> or the last <strong>IKE_INTERMEDIATE</strong> exchange).</li>
</ul>
<p>Key materials <strong>(SK_d, SK_ai, SK_ar, SK_ei, SK_er, SK_pi, SK_pr)</strong> are derived from <strong>SKEYSEED(n)</strong> using the following formula:</p>
<pre tabindex="0"><code>{SK_d(n) | SK_ai(n) | SK_ar(n) | SK_ei(n) | SK_er(n) | SK_pi(n) | SK_pr(n)}
= prf+ (SKEYSEED(n), Ni | Nr | SPIi | SPIr)
</code></pre><p>Both the initiator and responder use these updated keys in the next <strong>IKE_INTERMEDIATE</strong> or <strong>IKE_AUTH</strong> exchange.</p>
<pre tabindex="0"><code>[Initiator]                 [Responder]
    |                            |
    | ------ IKE_SA_INIT ------&gt; |
    |                            |
    |&lt;------ IKE_SA_INIT ------&gt; |
    |                            |
    |----- IKE_INTERMEDIATE ----&gt;|
    |                            |
    |&lt;----- IKE_INTERMEDIATE ---&gt;|
    |                            |
    |------- IKE_AUTH ---------&gt; |
    |                            |
    |&lt;------- IKE_AUTH ---------&gt;|
</code></pre><h3 id="option-2-using-ike_followup_ke-exchanges">Option 2: Using IKE_FOLLOWUP_KE Exchanges</h3>
<ol>
<li><strong>Initial IKE SA Setup</strong>:
<ul>
<li>An IKE SA is established using the standard <strong>IKE_SA_INIT</strong> and <strong>IKE_AUTH</strong> exchanges.</li>
</ul>
</li>
<li><strong>CREATE_CHILD_SA Exchange</strong>:
<ul>
<li>The ECDH key exchange negotiated via Transform Type 4 takes place in the <strong>CREATE_CHILD_SA</strong> exchange, as per the IKEv2 specification [<a href="https://datatracker.ietf.org/doc/html/rfc7296">RFC7296</a>].</li>
<li>The initiator proposes additional key exchanges via ADDKE(Additional Key Exchange) Transform Types in the <strong>CREATE_CHILD_SA</strong> payload.</li>
<li>If the responder agrees, additional key exchanges occur in a series of <strong>IKE_FOLLOWUP_KE</strong> exchanges.</li>
</ul>
</li>
<li><strong>IKE_FOLLOWUP_KE Exchanges</strong>:
<ul>
<li>Similar to the first option, but here additional key exchanges occur directly after the <strong>CREATE_CHILD_SA</strong> exchange.</li>
<li>Cryptographic parameters for ADDKE are exchanged. The exchange is protected with keys established through the <strong>CREATE_CHILD_SA</strong> exchange.</li>
</ul>
</li>
</ol>
<p>After the exchanges, both peers compute updated keying materials as follows:</p>
<p>For IKE SA rekey:</p>
<pre tabindex="0"><code>SKEYSEED = prf(SK_d, SK(0) | Ni | Nr | SK(1) | ... | SK(n))
    
</code></pre><ul>
<li><strong>SK_d</strong> is from the existing IKE SA.</li>
<li><strong>SK(0)</strong>, <strong>Ni</strong>, and <strong>Nr</strong> are the shared key and nonces from the CREATE_CHILD_SA exchange.</li>
<li><strong>SK(1)&hellip;SK(n)</strong> are shared keys from additional key exchanges.</li>
</ul>
<p>For Child SA creation or rekey:</p>
<pre tabindex="0"><code>KEYMAT = prf+ (SK_d, SK(0) | Ni | Nr | SK(1) | ... | SK(n))
 
</code></pre><p>In both cases, <strong>SK_d</strong> comes from the existing IKE SA, and the keying material is derived from <strong>SK(0), Ni, Nr</strong>, and additional shared keys.</p>
<pre tabindex="0"><code>[Initiator]                 [Responder]
    |                            |
    | ------ IKE_SA_INIT ------&gt; |
    |                            |
    |&lt;------ IKE_SA_INIT ------&gt; |
    |                            |
    |------ IKE_AUTH ----------&gt; |
    |                            |
    |&lt;------ IKE_AUTH ----------&gt;|
    |                            |
    |---- CREATE_CHILD_SA -----&gt; |
    |                            |
    |&lt;---- CREATE_CHILD_SA -----&gt;|
    |                            |
    |--- IKE_FOLLOWUP_KE ------&gt; |
    |                            |
    |&lt;--- IKE_FOLLOWUP_KE ------&gt;|
</code></pre><h2 id="choosing-the-method">Choosing the Method</h2>
<p>The choice between using <strong>IKE_INTERMEDIATE</strong> or <strong>IKE_FOLLOWUP_KE</strong> exchanges depends on the peers’ security policies. If the initial Child SA must be quantum secure, negotiating additional key exchanges through <strong>IKE_INTERMEDIATE</strong> exchanges may be preferable.</p>
<hr>
<h1 id="blast-integration-in-ikev2">BLAST Integration in IKEv2</h1>
<p>Qrypt solution leverages <a href="https://datatracker.ietf.org/doc/rfc9370/">RFC9370</a> specification that describes a method to perform multiple successive key exchanges in IKEv2. Qrypt keys are generated independently on each endpoint, however, to establish the same set of keys, parties must exchange the associated key metadata. Additional IKEv2 key exchanges are used to exchange the metadata.</p>
<h2 id="the-blast-protocol">The BLAST Protocol</h2>
<p>BLAST is the protocol used to eliminate key transmission and safeguard data against the Harvest Now Decrypt Later (HNDL) attack. </p>
<ol>
<li>The BLAST architecture enables generation of identical keys at multiple endpoints, so they are never distributed.</li>
<li>Caches of random allow for sampling by multiple clients – with time and usage controls that trigger cache shredding.</li>
<li>Client locally extracts keys from returned random – not even Qrypt can determine the keys.</li>
<li>No dedicated channels or infrastructure required – unlike quantum key distribution (QKD).</li>
</ol>
<figure><img src="../../sdk/nvidia/images/blast-architecture_1.png">
</figure>

<h3 id="walk-through"><strong>Walk-through</strong></h3>
<ol>
<li>Client A determines the key generation requirements: BLAST servers to be used, the sampling seeds, and extraction parameters</li>
<li>Clients share the key generation requirements – seeds, extraction parameters.</li>
<li>Each client independently samples BLAST APIs, assembling identical blocks of random on each client.</li>
<li>Clients locally extracts keys - resulting in identical encryption keys which were never distributed.</li>
</ol>
<p>For more information see <a href="https://cs.nyu.edu/~dodis/ps/blast.pdf">BLAST</a></p>
<h2 id="blast-key-exchange-in-ikev2">BLAST Key Exchange in IKEv2</h2>
<h3 id="option-1-using-ike_intermediate"><strong>Option 1: Using IKE_INTERMEDIATE</strong></h3>
<ul>
<li><strong>IKE_SA_INIT</strong> messages are used to negotiate the BLAST key exchange and establish ECDH SSK (shared secret key)</li>
<li>The initiator uses BLAST SDK to generate Qrypt key (QK) and the associated metadata</li>
<li>The metadata is transmitted in the <strong>IKE_INTERMEDIATE</strong> message, encrypted using keys established in the previous step</li>
<li>The responder uses BLAST SDK to generate the same QK from the received metadata</li>
<li>QK and ECDH SSK are used to derive encryption and authentication keys as per <a href="https://datatracker.ietf.org/doc/rfc9370/">RFC9370</a></li>
</ul>
<figure><img src="../../sdk/nvidia/images/Diagram_2.png">
</figure>

<h3 id="option-2-using-ike_followup_ke">Option 2: Using IKE_FOLLOWUP_KE</h3>
<ul>
<li>An IKE SA is established using the standard <strong>IKE_SA_INIT</strong> and <strong>IKE_AUTH</strong> exchanges.</li>
<li>The initiator proposes BLAST key exchange via ADDKE(Additional Key Exchange) Transform Types in the <strong>CREATE_CHILD_SA</strong> payload.</li>
<li>The initiator uses BLAST SDK to generate Qrypt key (QK) and the associated metadata</li>
<li>Exchange of the metadata occur directly after the <strong>CREATE_CHILD_SA</strong> exchange. The exchange is protected with keys established through the <strong>CREATE_CHILD_SA</strong> exchange.</li>
<li>The responder uses BLAST SDK to generate the same QK from the received metadata</li>
<li>QK and ECDH SSK are used to derive encryption and authentication keys as per <a href="https://datatracker.ietf.org/doc/rfc9370/">RFC9370</a></li>
</ul>
<figure><img src="../../sdk/nvidia/images/Diagram_1.png">
</figure>

<hr>
<h1 id="nvidia-quantum-secure-gateway-architecture">NVIDIA Quantum Secure Gateway Architecture</h1>
<figure><img src="../../sdk/nvidia/images/Diagram_4.png">
</figure>

<p>The process starts with IKEv2 negotiating Security Associations (SAs) between the initiator and responder, defining cryptographic parameters like algorithms and key lengths. An SA is uniquely identified by a triplet, which consists of the security parameter index (SPI), destination IP address, and security protocol identifier. An SPI is a 32-bit number. It is transmitted in the AH/ESP header. In IPsec, ESP uses these SAs to secure IP packets by referencing the Security Parameter Index (SPI) to identify the correct SA for each packet.</p>
<h3 id="association-of-esp-with-security-associations-sas">Association of ESP with Security Associations (SAs)</h3>
<ol>
<li>
<p><strong>SA Establishment</strong>: During the IKEv2 negotiation, strongSwan establishes SAs between peers, assigning a unique SPI to each SA. This SPI serves as an identifier for the SA&rsquo;s cryptographic parameters.</p>
</li>
<li>
<p><strong>Packet Processing</strong>: As ESP processes incoming packets, it examines the SPI in each packet&rsquo;s header. Using this SPI, ESP retrieves the corresponding SA from the Security Association Database (SAD) to apply the correct cryptographic operations.</p>
</li>
</ol>
<h3 id="how-esp-identifies-the-appropriate-sa">How ESP Identifies the Appropriate SA</h3>
<ol>
<li>
<p><strong>Receiving a Packet</strong>: When an IP packet arrives, ESP examines the SPI value in the packet&rsquo;s header.</p>
</li>
<li>
<p><strong>SA Lookup</strong>: Using the SPI, ESP searches its Security Association Database (SAD) to find the corresponding SA that matches the SPI. The SAD contains entries for each active SA, indexed by their SPIs.</p>
</li>
<li>
<p><strong>Applying Security Parameters</strong>: Once the matching SA is identified, ESP retrieves the cryptographic parameters (such as encryption and authentication algorithms) associated with that SA. It then processes the packet accordingly to ensure data confidentiality and integrity.</p>
</li>
</ol>
<h3 id="open-vswitch-ovs"><strong>Open vSwitch (OVS)</strong></h3>
<p>OVS is used to facilitate the transfer of plaintext messages between the host and the DPU. In this context, OVS acts as a software-based network switch that manages network traffic, routing messages between the host’s CPU and the DPU without encryption.</p>
<hr>
<h2 id="setup-east-west-overlay-encryption">Setup East-West Overlay Encryption</h2>
<p>Setting up east-west overlay encryption can be done in two steps:</p>
<ol>
<li>
<p><strong>Configure the OVS (Open vSwitch):</strong></p>
<ul>
<li>Setup the OVS bridge</li>
<li>Configure the authentication method</li>
</ul>
</li>
<li>
<p><strong>Run the script:</strong> Execute the following command, which runs the <em>ovs-monitor-ipsec</em> script and automates the configuration process:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span> systemctl start openvswitch<span style="color:#f92672">-</span>ipsec.service
</span></span></code></pre></div></li>
</ol>
<h2 id="configuring-the-ovs">Configuring the OVS</h2>
<h3 id="set-up-ovs-bridges-in-both-hosts"><strong>Set up OVS bridges in both hosts</strong></h3>
<ul>
<li>
<p>Start Open vSwitch. If your operating system is Ubuntu, run the following on both <em>Arm_1</em> and <em>Arm_2</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  service openvswitch<span style="color:#f92672">-</span><span style="color:#66d9ef">switch</span> start
</span></span></code></pre></div><p>If your operating system is CentOS, run the following on both <em>Arm_1</em> and <em>Arm_2</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span> service openvswitch restart
</span></span></code></pre></div></li>
<li>
<p>Start OVS IPsec service. Run the following on both <em>Arm_1</em> and <em>Arm_2</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>systemctl start openvswitch<span style="color:#f92672">-</span>ipsec.service
</span></span></code></pre></div></li>
<li>
<p>Set up OVS bridges in both DPUs. Run the following on both <em>Arm_1</em> and <em>Arm_2</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl add<span style="color:#f92672">-</span>br vxlan<span style="color:#f92672">-</span>br
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl add<span style="color:#f92672">-</span>port ovs<span style="color:#f92672">-</span>br <span style="color:#960050;background-color:#1e0010">$</span>PF_REP
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl set Open_vSwitch . other_config:hw<span style="color:#f92672">-</span>offload<span style="color:#f92672">=</span>true
</span></span></code></pre></div></li>
<li>
<p>Set up IPsec tunnel on the OVS bridge. Three authentication methods are possible. Select your preferred method and follow the steps relevant to it. Note that some authentication methods require you to create certificates (self-signed or certificate authority certificates).</p>
</li>
</ul>
<h3 id="authentication-methods">Authentication Methods</h3>
<p>There are three authentication methods:</p>
<p><strong>Using pre-shared key</strong></p>
<p>On <em>Arm_1</em>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl add<span style="color:#f92672">-</span>port vxlan<span style="color:#f92672">-</span>br tun <span style="color:#f92672">--</span> \
</span></span><span style="display:flex;"><span>            set interface tun type<span style="color:#f92672">=</span>vxlan \
</span></span><span style="display:flex;"><span>                          options:local_ip<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>ip1 \
</span></span><span style="display:flex;"><span>                          options:remote_ip<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>ip2 \
</span></span><span style="display:flex;"><span>                          options:key<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span> \
</span></span><span style="display:flex;"><span>                          options:dst_port<span style="color:#f92672">=</span><span style="color:#ae81ff">4789</span> \
</span></span><span style="display:flex;"><span>                          options:psk<span style="color:#f92672">=</span> your pre<span style="color:#f92672">-</span>shared secret value 
</span></span></code></pre></div><p>On <em>Arm_2</em>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl add<span style="color:#f92672">-</span>port vxlan<span style="color:#f92672">-</span>br tun <span style="color:#f92672">--</span> \
</span></span><span style="display:flex;"><span>            set interface tun type<span style="color:#f92672">=</span>vxlan \
</span></span><span style="display:flex;"><span>                          options:local_ip<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>ip2 \
</span></span><span style="display:flex;"><span>                          options:remote_ip<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>ip1 \
</span></span><span style="display:flex;"><span>                          options:key<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span> \
</span></span><span style="display:flex;"><span>                          options:dst_port<span style="color:#f92672">=</span><span style="color:#ae81ff">4789</span>\
</span></span><span style="display:flex;"><span>                          options:psk<span style="color:#f92672">=</span>your pre<span style="color:#f92672">-</span>shared secret value
</span></span></code></pre></div>
<div class="notices note" ><p>Pre-shared key (PSK) based authentication is easy to set up but less secure compared with other authentication methods. You should use it cautiously in production systems.</p>
</div>

<p><strong>Using self-signed certificates</strong></p>
<p>Generate self-signed certificate in both <em>Arm_1</em>and <em>Arm_2</em>. Then copy the certificate of <em>Arm_1</em> to <em>Arm_2</em> and the certificate of <em>Arm_2</em> to <em>Arm_1</em>.</p>
<p>On <em>Arm_1</em>, run:</p>
<p>Generate self-signed certificates</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki req <span style="color:#f92672">-</span>u host_1.       
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki self<span style="color:#f92672">-</span>sign host_1
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl set Open_vSwitch . other_config:certificate<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>x509<span style="color:#f92672">/</span>host_1<span style="color:#f92672">-</span>cert.pem \
</span></span><span style="display:flex;"><span>  other_config:private_key<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>private<span style="color:#f92672">/</span>host_1<span style="color:#f92672">-</span>privkey.pem
</span></span></code></pre></div><p>On <em>Arm_2</em>, run:</p>
<p>Generate self-signed certificates</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki req <span style="color:#f92672">-</span>u host_2.       
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki self<span style="color:#f92672">-</span>sign host_2
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>vsctl set Open_vSwitch . other_config:certificate<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>x509<span style="color:#f92672">/</span>host_2<span style="color:#f92672">-</span>cert.pem \
</span></span><span style="display:flex;"><span>  other_config:private_key<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>private<span style="color:#f92672">/</span>host_2<span style="color:#f92672">-</span>privkey.pem
</span></span></code></pre></div><ul>
<li>Copy the certificate of <em>Arm_1</em> to <em>Arm_2</em>, and the certificate of <em>Arm_2</em> to <em>Arm_1</em>.</li>
<li>On each machine, move both <em>host_1-privkey.pem</em> and <em>host_2-cert.pem</em> to <em>/etc/swanctl/x509/</em> if on Ubuntu, or <em>/etc/strongswan/swanctl/x509/</em> if on CentOS.</li>
<li>On each machine, move the local private key (<em>host_1-privkey.pem</em> on <em>Arm_1</em> and <em>host_2-privkey.pem</em> on <em>Arm_2</em>) to <em>/etc/swanctl/private</em> if on Ubuntu, or <em>/etc/strongswan/swanctl/private</em> if on CentOS.</li>
</ul>
<p><strong>Using CA-signed certificate:</strong></p>
<p>First you need to establish a public key infrastructure (PKI), generate certificate requests, and copy the certificate request of <em>Arm_1</em> to <em>Arm_2</em> and <em>Arm_2</em> to <em>Arm_1</em> . Sign the certificate requests with the CA key.</p>
<p>On <em>Arm_1</em>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki init <span style="color:#f92672">--</span>force
</span></span><span style="display:flex;"><span>cp <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>openvswitch<span style="color:#f92672">/</span>pki<span style="color:#f92672">/</span>controllerca<span style="color:#f92672">/</span>cacert.pem <span style="color:#f92672">&lt;</span>path_to<span style="color:#f92672">&gt;/</span>certsworkspace
</span></span><span style="display:flex;"><span>cd <span style="color:#f92672">&lt;</span>path_to<span style="color:#f92672">&gt;/</span>certsworkspace
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki req <span style="color:#f92672">-</span>u host_1
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki sign host1 <span style="color:#66d9ef">switch</span> 
</span></span></code></pre></div><p>After running this code, you should have host_1-cert.pem, host_1-privkey.pem, and cacert.pm in the certsworkspace folder.</p>
<p>On <em>Arm_2,</em> run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki init <span style="color:#f92672">--</span>force
</span></span><span style="display:flex;"><span>cp <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>openvswitch<span style="color:#f92672">/</span>pki<span style="color:#f92672">/</span>controllerca<span style="color:#f92672">/</span>cacert.pem <span style="color:#f92672">&lt;</span>path_to<span style="color:#f92672">&gt;/</span>certsworkspace
</span></span><span style="display:flex;"><span>cd <span style="color:#f92672">&lt;</span>path_to<span style="color:#f92672">&gt;/</span>certsworkspace
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki req <span style="color:#f92672">-</span>u host_2
</span></span><span style="display:flex;"><span>ovs<span style="color:#f92672">-</span>pki sign host_2 <span style="color:#66d9ef">switch</span>
</span></span></code></pre></div><p>After running this code, you should have host_2-cert.pem, host_2-privkey.pem, and cacert.pm in the certsworkspace folder.</p>
<ul>
<li>Copy the certificate of <em>Arm_1</em> to <em>Arm_2</em> and the certificate of <em>Arm_2</em> to <em>Arm_1</em>.</li>
<li>On each machine, move both <em>host_1-privkey.pem</em> and <em>host_2-cert.pem</em> to <em>/etc/swanctl/x509/</em> if on Ubuntu, or <em>/etc/strongswan/swanctl/x509/</em> if on CentOS.</li>
<li>On each machine, move the local private key (<em>host_1-privkey.pem</em> if on <em>Arm_1</em> and <em>host_2-privkey.pem</em> if on <em>Arm_2</em>) to <em>/etc/swanctl/private</em> if on Ubuntu, or <em>/etc/strongswan/swanctl/private</em> if on CentOS.</li>
<li>On each machine, copy <em>cacert.pem</em> to the <em>x509ca</em> directory under <em>/etc/swanctl/x509ca/</em> if on Ubuntu, or <em>/etc/strongswan/swanctl/x509ca/</em> if on CentOS.</li>
</ul>
<p>Configure IPsec tunnel to use CA-signed certificate:</p>
<p>On <em>Arm_1</em>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span> ovs<span style="color:#f92672">-</span>vsctl set Open_vSwitch . \
</span></span><span style="display:flex;"><span>        other_config:certificate<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>strongswan<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>x509<span style="color:#f92672">/</span>host_1.pem \
</span></span><span style="display:flex;"><span>        other_config:private_key<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>strongswan<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>private<span style="color:#f92672">/</span>host_1<span style="color:#f92672">-</span>privkey.pem \
</span></span><span style="display:flex;"><span>        other_config:ca_cert<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>strongswan<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>x509ca<span style="color:#f92672">/</span>cacert.pem
</span></span></code></pre></div><p>On <em>Arm_2</em>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span> ovs<span style="color:#f92672">-</span>vsctl set Open_vSwitch . \
</span></span><span style="display:flex;"><span>        other_config:certificate<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>strongswan<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>x509<span style="color:#f92672">/</span>host_2.pem \
</span></span><span style="display:flex;"><span>        other_config:private_key<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>strongswan<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>private<span style="color:#f92672">/</span>host_2<span style="color:#f92672">-</span>privkey.pem \
</span></span><span style="display:flex;"><span>        other_config:ca_cert<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>strongswan<span style="color:#f92672">/</span>swanctl<span style="color:#f92672">/</span>x509ca<span style="color:#f92672">/</span>cacert.pem
</span></span></code></pre></div><h2 id="execute-a-script">Execute a script</h2>
<p>After OVS is configured, run the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>systemctl start openvswitch<span style="color:#f92672">-</span>ipsec.service
</span></span></code></pre></div><p>This command automatically runs the <em>ovs-monitor-ipsec</em> script and generates the <em>swanctl.conf</em> file. This command also runs the strongSwan IPsec service.</p>
<h3 id="script-parameters">Script Parameters</h3>
<p>Note that critical information such as key exchange and authentication algorithms to be used for IKE SA and ESP SA are passed in the <em>ovs-monitor-ipsec</em> script to later generate a <em>swanctl.conf</em> file. Ensure that the script contains all the key exchange algorithms to be used for IKE SA establishment. For instance, parameters <em>ke1_kyber3-ke2_blast</em> passed in the <em>ovs-monitor-ipsec</em> script</p>
<pre tabindex="0"><code>sudo sed -i &#39;s/aes256gcm16-modp2048-esn/aes256gcm16-modp2048-ke1_kyber3-ke2_blast-esn/g&#39; /usr/share/openvswitch/scripts/ovs-monitor-ipsec
</code></pre><p>will result in <em>swanctl.conf</em>  parameters:</p>
<pre tabindex="0"><code>esp_proposals = aes128gcm128-x25519-ke1_kyber3-ke2_blast
</code></pre><h3 id="strongswan-configuration-file">strongSwan configuration file</h3>
<p>Here’s a basic structure for the <em>swanctl.conf</em> file that includes necessary parameters for both ends of the connection (referred to as Left (BFL) and Right (BFR)):</p>
<pre tabindex="0"><code>connections {
BFL-BFR {
local_addrs = 192.168.50.1       // Replace with your local IP
remote_addrs = 192.168.50.2      // Replace with your remote IP
local {
auth = psk                   // Use pre-shared key authentication
id = host1                   // Identifier for local machine
}
remote {
auth = psk                   // Use pre-shared key authentication
id = host2                   // Identifier for remote machine
}
children {
bf {
local_ts = 192.168.50.1/24 [udp/4789]  // Local traffic selectors
remote_ts = 192.168.50.2/24 [udp/4789] // Remote traffic selectors
esp_proposals = aes128gcm128-x25519   // Encryption proposals should include additional key exchanges  
mode = transport              // Use transport mode
policies_fwd_out = yes       // Forward output policies
hw_offload = full            // Enable hardware offload
}
}
version = 2                        // Specify version
mobike = no                        / Mobile IP not used
reauth_time = 0                    // Re-authentication time
proposals = aes128-sha256-x25519   // IKE proposals
}
}
</code></pre><p>If using pre-shared key (PSK) for authentication, add a section to the <em>swanctl.conf</em> file:</p>
<pre tabindex="0"><code>secrets {
    ike-BF {
        id-host1 = host1                       // Identifier for Left Arm
        id-host2 = host2                       // Identifier for Right Arm
        secret = 0sv+NkxY9LLZvwj4qCC2o/gGrWDF2d21jL  // Replace with your actual secret
    }
}
</code></pre><p>Ensure that all the data needed to generate the <em>swanctl.conf</em> file is correctly passed in the <em>ovs-monitor-ipsec</em> script.</p>
<p>For more information see <a href="https://docs.nvidia.com/doca/sdk/nvidia+doca+east-west+overlay+encryption+application/index.html"> NVIDIA DOCA East-West Overlay Encryption Application</a></p>
<hr>
<h1 id="build-strongswan-with-liboqs-and-qrypts-blast--plugin">Build strongSwan with liboqs and Qrypt&rsquo;s BLAST  plugin</h1>
<h3 id="create-a-directory-to-clone-the-repos-into">Create a directory to clone the repos into</h3>
<pre tabindex="0"><code>mkdir qrypt
cd qrypt
</code></pre><h3 id="clone-and-build-liboqs">Clone and build liboqs</h3>
<pre tabindex="0"><code>sudo apt -y install astyle cmake gcc ninja-build libssl-dev python3-pytest python3-pytest-xdist unzip xsltproc doxygen graphviz python3-yaml valgrind

git clone -b main &lt;https://github.com/open-quantum-safe/liboqs.git&gt;
cd liboqs

mkdir build
cd build
cmake -GNinja -DOQS_USE_OPENSSL=ON -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX=/usr \\
              -DCMAKE_BUILD_TYPE=Release -DOQS_BUILD_ONLY_LIB=ON ..
ninja
sudo ninja install

cd ../../
</code></pre><h3 id="clone-the-strongswan-repo">Clone the strongSwan repo</h3>
<pre tabindex="0"><code>git clone &lt;https://github.com/QryptInc/strongswan.git&gt;
cd strongswan
git checkout BF-6.0.0beta4-qrypt-plugins
</code></pre><h3 id="edit-the-plugin-conf-files">Edit the plugin conf files</h3>
<p>Create a free account at <a href="https://docs.qrypt.com/getting_started/">https://docs.qrypt.com/getting_started/</a> This will enable you to generate JSON web tokens (JWT) that you&rsquo;ll need to add to the conf files.</p>
<p><em>strongswan/src/libstrongswan/plugins/quantum_entropy/quantum-entropy.conf</em>:</p>
<pre tabindex="0"><code>quantum_entropy {
    // Entropy API FQDN
    fqdn = api-eus.qrypt.com

    // Entropy API JWT
    jwt = &lt;PASTE-TOKEN-HERE&gt;

    // File to read local random bytes for xor with downloaded entropy
    random = /dev/random

    // Whether to load the plugin. Can also be an integer to increase the
    // priority of this plugin.
    load = yes
}
</code></pre><p><em>strongswan/src/libstrongswan/plugins/blast/blast.conf:</em></p>
<pre tabindex="0"><code>blast {

    jwt = &lt;PASTE-TOKEN-HERE&gt;

    load = yes

}
</code></pre><h3 id="build-strongswan">Build strongSwan</h3>
<p>Building a strongSwan 6.X tag will include support for <a href="https://datatracker.ietf.org/doc/rfc9370/">RFC 9370</a> which will allow for hybrid key exchanges including PQC and BLAST.</p>
<pre tabindex="0"><code>sudo apt-get -y install pkg-config shtool autoconf gperf bison build-essential pkg-config m4 libtool libgmp3-dev automake autoconf gettext perl flex libsystemd-dev libjansson-dev curl libcurl4-openssl-dev

./autogen.sh
./configure --enable-openssl --disable-random --prefix=/usr/local --sysconfdir=/etc --enable-systemd --enable-oqs --enable-curl
make
sudo make install

cd ..
</code></pre><h3 id="build-qrypts-blast-plugin">Build Qrypt&rsquo;s BLAST plugin</h3>
<p>Retrieve Qrypt&rsquo;s SDK library from the Qrypt Portal from &ldquo;Products-&gt;Qrypt SDK&rdquo;. Copy the libQryptSecurity.so and
libQryptSecurityC.so libraries to <em>src/libstrongswan/plugins/blast/</em>. Then, proceed with the following instructions.</p>
<pre tabindex="0"><code>cd src/libstrongswan/plugins/blast/
sudo make install-deps
sudo ldconfig
make SWANDIR=../../../..
sudo make install PLUGINCONF=/etc/strongswan.d/charon/
cd ../../../..
</code></pre><h3 id="start-and-stop-service">Start and stop service</h3>
<pre tabindex="0"><code>sudo systemctl daemon-reload
sudo systemctl stop strongswan.service
sudo systemctl start strongswan.service
sudo systemctl status strongswan.service
</code></pre>




<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1734382870"></script>
    <script src="../../js/perfect-scrollbar.min.js?1734382870"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1734382870"></script>
    <script src="../../js/jquery.sticky.js?1734382870"></script>
    <script src="../../js/featherlight.min.js?1734382870"></script>
    <script src="../../js/highlight.pack.js?1734382870"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1734382870"></script>
    <script src="../../js/learn.js?1734382870"></script>
    <script src="../../js/hugo-learn.js?1734382870"></script>
    
        
            <script src="../../mermaid/mermaid.js?1734382870"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
